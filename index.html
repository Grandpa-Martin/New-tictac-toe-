import random
import time
import os

# -----------------------------
# Cash Flow Game - Enhanced Console Version
# By Command of Master Lord DaRuT
# -----------------------------

class Player:
    def __init__(self, name):
        self.name = name
        self.job = random.choice(list(JOB_ROLES.keys()))
        job_data = JOB_ROLES[self.job]
        self.income = job_data['income']
        self.expenses = job_data['expenses']
        self.assets = []
        self.liabilities = []
        self.cash = 1000
        self.passive_income = 0
        self.position = 0
        self.in_rat_race = True
        self.dream = random.choice(DREAMS)
        self.escaped = False
    
    def net_worth(self):
        asset_value = sum(asset['value'] for asset in self.assets)
        liability_value = sum(liability['amount'] for liability in self.liabilities)
        return asset_value - liability_value + self.cash
    
    def update_passive_income(self):
        self.passive_income = sum(asset['income'] for asset in self.assets if 'income' in asset)
    
    def pay_expenses(self):
        net_expense = max(0, self.expenses - self.passive_income)
        self.cash -= net_expense
        return net_expense
    
    def display_status(self):
        print(f"\n╔════════════ {self.name}'s Status ════════════╗")
        print(f"║ {'Job:':<15}{self.job:<25}║")
        print(f"║ {'Income:':<15}${self.income:<24}║")
        print(f"║ {'Expenses:':<15}${self.expenses:<24}║")
        print(f"║ {'Cash:':<15}${self.cash:<24}║")
        print(f"║ {'Passive Income:':<15}${self.passive_income:<24}║")
        print(f"║ {'Net Worth:':<15}${self.net_worth():<24}║")
        print(f"║ {'Position:':<15}{self.position:<25}║")
        print(f"║ {'Rat Race:':<15}{'Yes' if self.in_rat_race else 'No!':<25}║")
        print(f"║ {'Dream:':<15}{self.dream:<25}║")
        print("╚══════════════════════════════════════╝")
        
        # Display assets and liabilities
        if self.assets:
            print("\nAssets:")
            for asset in self.assets:
                print(f" - {asset['name']} (Value: ${asset['value']}, Income: ${asset.get('income', 0)})")
        
        if self.liabilities:
            print("\nLiabilities:")
            for liability in self.liabilities:
                print(f" - {liability['name']}: ${liability['amount']}/month")

# -----------------------------
# Game Constants
# -----------------------------

JOB_ROLES = {
    "Teacher": {"income": 3000, "expenses": 2500},
    "Doctor": {"income": 8000, "expenses": 6000},
    "Mechanic": {"income": 4000, "expenses": 3000},
    "Artist": {"income": 2500, "expenses": 2000},
    "Lawyer": {"income": 7000, "expenses": 5500},
    "Engineer": {"income": 6000, "expenses": 4500},
}

DREAMS = [
    "Own a Tropical Island",
    "Start a Space Tourism Company",
    "Open a Chain of Vegan Restaurants",
    "Build a Wildlife Sanctuary",
    "Launch a Record Label",
    "Create a Tech Unicorn"
]

OPPORTUNITIES = [
    {"type": "stock", "name": "Tech Stock", "cost": 500, "income": 0, "value": 800},
    {"type": "real estate", "name": "Rental Property", "cost": 2000, "income": 200, "value": 3000},
    {"type": "business", "name": "Food Truck", "cost": 1500, "income": 300, "value": 2000},
    {"type": "franchise", "name": "Mini Mart Franchise", "cost": 5000, "income": 800, "value": 7000},
    {"type": "crypto", "name": "Cryptocurrency", "cost": 1000, "income": 0, "value": 1500},
    {"type": "land", "name": "Undeveloped Land", "cost": 3000, "income": 0, "value": 6000}
]

DOODADS = [
    {"name": "Buy a New Phone", "cost": 800},
    {"name": "Luxury Vacation", "cost": 2000},
    {"name": "Emergency Medical Bill", "cost": 1200},
    {"name": "Wedding Gift", "cost": 500},
    {"name": "New Car", "cost": 3000},
    {"name": "Designer Wardrobe", "cost": 1500},
    {"name": "Home Renovation", "cost": 4000},
    {"name": "Boat Purchase", "cost": 3500}
]

MARKET_EVENTS = [
    {"name": "Stock Market Boom", "effect": "assets", "multiplier": 1.5},
    {"name": "Real Estate Crash", "effect": "real estate", "multiplier": 0.7},
    {"name": "Inflation Spike", "effect": "expenses", "amount": 500},
    {"name": "Tax Refund", "effect": "cash", "amount": 1000},
    {"name": "Business Boom", "effect": "income", "amount": 1000}
]

# -----------------------------
# Game Functions
# -----------------------------

def clear_screen():
    os.system('cls' if os.name == 'nt' else 'clear')

def draw_card(deck):
    return random.choice(deck)

def display_header(title):
    clear_screen()
    print("\n" + "═" * 50)
    print(f"║{' ' * 16}{title}{' ' * 16}║")
    print("═" * 50 + "\n")

def take_turn(player, players):
    display_header(f"{player.name}'s Turn")
    player.display_status()
    
    input("\nPress Enter to roll the dice...")
    roll = random.randint(1, 6)
    player.position = (player.position + roll) % 20
    
    print(f"\n🎲 Rolled a {roll}! Moved to position {player.position}")
    
    # Position-based events
    if player.position == 0:
        print("\n🌟 Starting position bonus: $500!")
        player.cash += 500
    elif player.position % 5 == 0:
        card = draw_card(DOODADS)
        print(f"\n💸 DOODAD: {card['name']} (-${card['cost']})")
        player.cash -= card['cost']
    elif player.position % 4 == 0:
        event = draw_card(MARKET_EVENTS)
        print(f"\n📈 MARKET EVENT: {event['name']}")
        apply_market_event(event, player, players)
    elif player.position % 3 == 0:
        card = draw_card(OPPORTUNITIES)
        print(f"\n💼 OPPORTUNITY: {card['name']}")
        print(f"   Cost: ${card['cost']}, Income: ${card['income']}, Value: ${card['value']}")
        
        if player.cash < card['cost']:
            print("   ❌ Insufficient funds to invest")
            return
        
        choice = input("   Do you want to invest? (y/n): ").strip().lower()
        if choice == 'y':
            player.assets.append(card)
            player.cash -= card['cost']
            print("   ✅ Investment made!")
    
    # Update game state
    player.update_passive_income()
    expense = player.pay_expenses()
    print(f"\n📝 Monthly Expenses: ${expense}")
    
    if player.passive_income >= player.expenses and player.in_rat_race:
        player.in_rat_race = False
        player.escaped = True
        print(f"\n🎉 CONGRATULATIONS {player.name}! You've escaped the Rat Race! 🎉")
        time.sleep(2)

def apply_market_event(event, current_player, players):
    if event['effect'] == "assets":
        multiplier = event['multiplier']
        print(f"   All assets increase by {multiplier}x!")
        for player in players:
            for asset in player.assets:
                asset['value'] = int(asset['value'] * multiplier)
                if 'income' in asset:
                    asset['income'] = int(asset['income'] * multiplier)
    
    elif event['effect'] == "real estate":
        multiplier = event['multiplier']
        print(f"   Real estate values change by {multiplier}x!")
        for player in players:
            for asset in player.assets:
                if asset['type'] == "real estate":
                    asset['value'] = int(asset['value'] * multiplier)
                    asset['income'] = int(asset['income'] * multiplier)
    
    elif event['effect'] == "expenses":
        amount = event['amount']
        print(f"   Everyone's expenses increase by ${amount}!")
        for player in players:
            player.expenses += amount
    
    elif event['effect'] == "cash":
        print(f"   {current_player.name} receives ${event['amount']}!")
        current_player.cash += event['amount']
    
    elif event['effect'] == "income":
        print(f"   {current_player.name}'s salary increases by ${event['amount']}!")
        current_player.income += event['amount']

def fast_track(player):
    display_header("FAST TRACK")
    print(f"{player.name} is pursuing their dream: {player.dream}!\n")
    turns = 0
    
    while turns < 5:
        print(f"🚀 Turn {turns + 1}/5")
        input("Press Enter to pursue your dream...")
        
        chance = random.randint(1, 6)
        if chance >= 5:  # 33% chance
            print(f"\n✨ EUREKA! {player.name} has achieved the dream: {player.dream}! ✨")
            print("🏆 YOU WIN THE GAME! 🏆")
            return True
        else:
            gain = random.randint(5000, 20000)
            player.cash += gain
            print(f"\n💸 Earned ${gain} on the Fast Track")
            print(f"💰 Current Cash: ${player.cash}")
            turns += 1
            time.sleep(1)
    
    print("\n⏳ Time's up! You didn't achieve your dream but built wealth.")
    print(f"💎 Final Net Worth: ${player.net_worth()}")
    return False

def play_game():
    display_header("CASH FLOW CONQUEST")
    print("Escape the Rat Race by building passive income!\n")
    
    num_players = 0
    while num_players < 2 or num_players > 6:
        try:
            num_players = int(input("Enter number of players (2-6): "))
        except ValueError:
            print("Please enter a valid number")
    
    players = []
    for i in range(num_players):
        name = input(f"Enter name for Player {i+1}: ")
        players.append(Player(name))
    
    round_count = 1
    winner = None
    
    while not winner:
        display_header(f"ROUND {round_count}")
        print(f"Passive income must exceed expenses to escape the Rat Race!\n")
        
        for player in players:
            if player.escaped:
                continue
                
            take_turn(player, players)
            
            if player.escaped:
                winner = player
                break
        
        round_count += 1
        time.sleep(1)
    
    # Fast track phase
    print(f"\n\n{winner.name} has reached the Fast Track!")
    time.sleep(2)
    fast_track(winner)
    
    print("\n\nGame Over. Wealth is yours, Master!")

# -----------------------------
# Launch Game
# -----------------------------

if __name__ == "__main__":
    play_game()
